
# FS Manager Elite (FSM 3.0.0) 开发指导手册

## 1. 项目概览
FS Manager Elite 是一款基于 React 19 + TypeScript 开发的高深度花样滑冰模拟经营游戏。它集成了实时比赛引擎、完整的世界排名生态系统（150名动态 AI 选手）以及多维度的职业生涯养成系统。

## 2. 技术栈与架构
- **核心框架**: React 19 (Hooks, Functional Components)
- **类型安全**: TypeScript (强类型定义位于 `types.ts`)
- **样式方案**: Tailwind CSS (深色主题设计，Slate-950 规范)
- **图表系统**: Recharts (用于渲染成长趋势与商业价值)
- **持久化**: `localStorage` (Key: `FS_MANAGER_V11_PRO`)

## 3. 核心逻辑模块

### 3.1 比赛引擎 (`MatchEngine`)
比赛评分逻辑基于以下公式：
- **TES (技术分)**: `((赛事基础分 + 风险收益) + (选手技术属性 * 0.9) + 随机波动) * 体力修正`
- **PCS (艺术分)**: `((选手艺术属性 * 1.1 + 节目基础艺术分) * 节目新鲜度修正) * 体力修正`
- **失误判定**: 基于玩家选择的策略风险。失误会使 TES 折损 40%。
- **体力修正 (Stamina Factor)**: `0.92 + (当前体力 / 100) * 0.08`。模拟疲劳对技术精确度和艺术表现力的负面影响。

### 3.2 世界排名系统 (`Ranking System`)
- **基数**: 全球 150 名注册选手。
- **积分逻辑 (Rolling Points)**: `当前赛季积分 + (上赛季积分 * 0.7)`。
- **新陈代谢**: AI 选手达到 33 岁或概率触发退休，系统会自动生成 14-16 岁的新秀进入排名池。

### 3.3 训练与体力逻辑 (`Progression`)
- **体力损耗**: 每项训练任务消耗固定体力；休息任务回复体力。
- **训练效率**:
    - `体力 >= 20`: 100% 效率。
    - `体力 < 20`: 30% 效率（模拟因疲劳导致的无效训练）。
    - `体力 == 0`: 0% 效率（颗粒无收）。

## 4. 开发与扩展指南

### 4.1 如何添加新赛事
在 `App.tsx` 的 `seasonCalendar` 变量中添加。参数说明：
- `req`: 入围所需的最低世界排名积分。
- `pts`: 该赛事的积分总包。
- `max`: 参赛选手数（包含玩家）。

### 4.2 数值平衡调整 (`constants.tsx`)
- **体力消耗**: 调整 `MATCH_STAMINA_COST`。
- **属性成长**: 修改 `nextMonth` 函数中的 `trainingEfficiency` 定义。

## 5. 状态管理规范
- 所有的状态变更必须通过 `setGame` 进行。
- 在执行 **重置生涯** 操作时，必须同时调用 `generateInitialAI()` 重新填充 150 名选手数据。

## 6. UI/UX 规范
- **精度**: 所有显示的属性值（TEC/ART）在 UI 上必须通过 `.toFixed(2)` 保留两位小数。
- **警告**: 当体力过低且无休息计划时，UI 必须通过红色文字及动画进行警告。

---
*文档版本: 2024.12.24 (基于 FSM 2.0.1)*
